<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ระบบรับสมัครนักเรียน 2569 - โรงเรียนบางมดวิทยา "สีสุกหวาดจวนอุปถัมภ์"</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  
  <?!= include('css'); ?>
</head>
<body>
  
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="#">
      <img src="https://www.bangmodwittaya.ac.th/_files_school/10107201/data/10107201_0_20230507-183213.png" alt="Logo" style="height: 40px; margin-right: 10px;">
      <span style="color: white; font-weight: 600;">ระบบรับสมัครนักเรียน<br><small style="font-size: 0.85rem;">โรงเรียนบางมดวิทยา "สีสุกหวาดจวนอุปถัมภ์"</small></span>
    </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item d-none" id="welcomeTextContainer">
            <span class="navbar-text text-white me-3">
              <i class="bi bi-person-circle"></i> ยินดีต้อนรับ เจ้าหน้าที่
            </span>
          </li>
          <li class="nav-item" id="loginBtnContainer">
            <button class="btn btn-light btn-sm" id="loginBtn">
              <i class="bi bi-shield-lock"></i> เข้าสู่ระบบเจ้าหน้าที่
            </button>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="container mt-4" id="mainContainer">
    
    <div id="publicView">
<div class="hero-section text-center mb-5">
  <h1 class="display-4 fw-bold" style="color: white;">ระบบรับสมัครนักเรียน 2569</h1>
  <p class="lead" style="color: rgba(255, 255, 255, 0.95);">โรงเรียนบางมดวิทยา "สีสุกหวาดจวนอุปถัมภ์"</p>
</div>

      <div id="prContentContainer" class="pr-display-container mb-4" style="display: none;">
        <div class="card shadow-sm">
          <div class="card-body" id="prContentDisplay">
          </div>
        </div>
      </div>

      <div class="text-center mb-5" id="mainMenuButton">
        <button class="btn btn-success btn-lg px-5 py-3" id="btnShowCheckStatus">
          <i class="bi bi-search"></i> สมัครเรียน / ตรวจสอบสถานะการสมัคร / พิมพ์บัตร
        </button>
      </div>

      <div class="card shadow-sm mb-4" id="checkStatusCard" style="display: none;">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0"><i class="bi bi-search"></i> สมัครเรียน / ตรวจสอบสถานะการสมัคร / พิมพ์บัตร</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-8">
              <label class="form-label">เลขบัตรประชาชน / เลขบัตรคนต่างด้าว</label>
              <input type="text" class="form-control" id="checkNationalId" placeholder="กรอกเลขบัตร 13 หลัก" maxlength="13">
            </div>
            <div class="col-md-4 d-flex align-items-end">
              <button class="btn btn-success w-100" id="btnCheckStatus">
                <i class="bi bi-search"></i> ตรวจสอบ
              </button>
            </div>
          </div>
          
          <div id="statusResults" class="mt-4" style="display: none;">
            <hr>
            <h6 class="text-success">ผลการค้นหา</h6>
            <div id="statusResultsContent"></div>
          </div>
        </div>
      </div>

      <div id="applicationMenu" style="display: none;">
        <div class="alert alert-info">
          <i class="bi bi-info-circle"></i> กรุณาเลือกประเภทการสมัครเรียน
        </div>

        <div class="card shadow-sm mb-3">
          <div class="card-header bg-primary text-white">
            <h5 class="mb-0"><i class="bi bi-1-circle"></i> สมัครเรียนชั้น ม.1</h5>
          </div>
          <div class="card-body">
            <div class="row g-3" id="m1Options">
            </div>
          </div>
        </div>

        <div class="card shadow-sm mb-3">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="bi bi-4-circle"></i> สมัครเรียนชั้น ม.4</h5>
          </div>
          <div class="card-body">
            <div class="row g-3" id="m4Options">
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="adminView" style="display: none;">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2><i class="bi bi-gear-fill"></i> ระบบจัดการข้อมูล (เจ้าหน้าที่)</h2>
        <button class="btn btn-danger" id="btnLogout">
          <i class="bi bi-box-arrow-right"></i> ออกจากระบบ
        </button>
      </div>

      <ul class="nav nav-tabs mb-4" id="adminTabs">
        <li class="nav-item">
          <button class="nav-link active" data-tab="viewApplicants">ตรวจสอบผู้สมัคร</button>
        </li>
        <li class="nav-item">
          <button class="nav-link" data-tab="editData">แก้ไขข้อมูล</button>
        </li>
        <li class="nav-item">
          <button class="nav-link" data-tab="statistics">สถิติ</button>
        </li>
        <li class="nav-item">
          <button class="nav-link" data-tab="adminRegistration">รับสมัครนักเรียน (เจ้าหน้าที่)</button>
        </li>
        <li class="nav-item">
          <button class="nav-link" data-tab="publicRelations">ประชาสัมพันธ์</button>
        </li>
        <li class="nav-item">
          <button class="nav-link" data-tab="settings">ตั้งค่า</button>
        </li>
        <li class="nav-item">
          <button class="nav-link" data-tab="backup">สำรองข้อมูล</button>
        </li>
      </ul>

      <div id="adminContent">
        <div class="tab-content" id="viewApplicantsTab">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">รายชื่อผู้สมัคร</h5>
            </div>
            <div class="card-body">
              <div class="row mb-3">
                <div class="col-md-4">
                  <label class="form-label">กรองตามระดับชั้น</label>
                  <select class="form-select" id="filterType">
                    <option value="">ทั้งหมด</option>
                    <option value="M.1">ม.1</option>
                    <option value="M.4">ม.4</option>
                  </select>
                </div>
                <div class="col-md-4">
                  <label class="form-label">กรองตามประเภท</label>
                  <select class="form-select" id="filterSubType">
                    <option value="">ทั้งหมด</option>
                  </select>
                </div>
                <div class="col-md-4 d-flex align-items-end">
                  <button class="btn btn-primary w-100" id="btnFilterApplicants">
                    <i class="bi bi-funnel"></i> กรองข้อมูล
                  </button>
                </div>
              </div>
              <div class="table-responsive">
                <table class="table table-striped table-hover" id="applicantsTable">
                  <thead class="table-dark">
                    <tr>
                      <th>ลำดับ</th>
                      <th>วันที่สมัคร</th>
                      <th>เลขบัตร</th>
                      <th>ชื่อ-สกุล</th>
                      <th>ระดับ</th>
                      <th>ประเภท</th>
                      <th>เบอร์โทร</th>
                      <th>ทะเบียนบ้าน</th>
                      <th>ใบรับรอง</th>
                      <th>สถานะ</th>
                    </tr>
                  </thead>
                  <tbody id="applicantsTableBody">
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="editDataTab" style="display: none;">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">แก้ไขข้อมูลผู้สมัคร</h5>
            </div>
            <div class="card-body">
              <div class="row mb-4">
                <div class="col-md-6">
                  <label class="form-label">ค้นหาด้วยเลขบัตรประชาชน</label>
                  <input type="text" class="form-control" id="searchNationalId" maxlength="13">
                </div>
                <div class="col-md-6 d-flex align-items-end gap-2">
                  <button class="btn btn-primary" id="btnSearchApplicant">
                    <i class="bi bi-search"></i> ค้นหา
                  </button>
                  <button class="btn btn-secondary" id="btnNewSearch">
                    <i class="bi bi-arrow-clockwise"></i> ค้นหาใหม่
                  </button>
                </div>
              </div>
              <div id="editApplicationSelection" style="display: none;">
              </div>
              <div id="editFormContainer" style="display: none;">
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="statisticsTab" style="display: none;">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">สถิติผู้สมัคร</h5>
            </div>
            <div class="card-body">
              <div class="row mb-3">
                <div class="col-md-4">
                  <label class="form-label">กรองตามวันที่</label>
                  <input type="date" class="form-control" id="filterDate">
                </div>
                <div class="col-md-4 d-flex align-items-end">
                  <button class="btn btn-primary me-2" id="btnFilterStats">
                    <i class="bi bi-funnel"></i> กรอง
                  </button>
                  <button class="btn btn-secondary" id="btnClearDateFilter">
                    <i class="bi bi-x-circle"></i> ล้างตัวกรอง
                  </button>
                </div>
              </div>
              <div id="statsContent">
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="adminRegistrationTab" style="display: none;">
          <div class="card">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0"><i class="bi bi-person-plus"></i> รับสมัครนักเรียน (เจ้าหน้าที่)</h5>
            </div>
            <div class="card-body">
              <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> 
                <strong>สำหรับเจ้าหน้าที่:</strong> สามารถรับสมัครนักเรียนโดยไม่ต้องแนบเอกสาร (ไฟล์) หากยังไม่มีเอกสารพร้อม
              </div>

              <div class="card shadow-sm mb-4">
                <div class="card-header bg-success text-white">
                  <h6 class="mb-0"><i class="bi bi-search"></i> ค้นหานักเรียนด้วยเลขบัตรประชาชน</h6>
                </div>
                <div class="card-body">
                  <div class="row">
                    <div class="col-md-8">
                      <label class="form-label">เลขบัตรประชาชน (13 หลัก)</label>
                      <input type="text" class="form-control" id="adminCheckNationalId" maxlength="13" placeholder="กรอกเลขบัตรประชาชน">
                    </div>
                    <div class="col-md-4 d-flex align-items-end">
                      <button class="btn btn-primary w-100" id="btnAdminCheckStatus">
                        <i class="bi bi-search"></i> ตรวจสอบ
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              <div id="adminStatusResultsWrapper" style="display: none;">
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="publicRelationsTab" style="display: none;">
          <div class="card">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0"><i class="bi bi-megaphone"></i> จัดการข้อมูลประชาสัมพันธ์</h5>
            </div>
            <div class="card-body">
              <div class="alert alert-info">
                <i class="bi bi-info-circle"></i>
                <strong>คำแนะนำ:</strong> ข้อความที่บันทึกจะแสดงบนหน้าหลักสำหรับผู้สมัคร (ด้านบนปุ่มสมัครเรียน)
              </div>

              <div id="pr-editor-container">
                <div id="pr-toolbar">
                  <span class="ql-formats">
                    <select class="ql-size">
                      <option value="small">เล็ก</option>
                      <option selected>ปกติ</option>
                      <option value="large">ใหญ่</option>
                      <option value="huge">ใหญ่มาก</option>
                    </select>
                  </span>
                  <span class="ql-formats">
                    <button class="ql-bold"></button>
                    <button class="ql-italic"></button>
                    <button class="ql-underline"></button>
                  </span>
                  <span class="ql-formats">
                    <select class="ql-color"></select>
                    <select class="ql-background"></select>
                  </span>
                  <span class="ql-formats">
                    <button class="ql-list" value="ordered"></button>
                    <button class="ql-list" value="bullet"></button>
                    <button class="ql-align" value=""></button>
                    <button class="ql-align" value="center"></button>
                    <button class="ql-align" value="right"></button>
                  </span>
                  <span class="ql-formats">
                    <button class="ql-link"></button>
                  </span>
                  <span class="ql-formats">
                    <button class="ql-clean"></button>
                  </span>
                </div>

                <div id="pr-editor" style="min-height: 300px; background: white;">
                </div>
              </div>

              <div class="mt-3">
                <small class="text-muted" id="prLastUpdated">
                  <i class="bi bi-clock"></i> ยังไม่มีข้อมูล
                </small>
              </div>

              <div class="mt-4">
                <button class="btn btn-success" id="btnSavePR">
                  <i class="bi bi-save"></i> บันทึกข้อมูล
                </button>
                <button class="btn btn-warning" id="btnPreviewPR">
                  <i class="bi bi-eye"></i> ดูตัวอย่าง
                </button>
                <button class="btn btn-danger" id="btnClearPR">
                  <i class="bi bi-trash"></i> ล้างข้อมูล
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="settingsTab" style="display: none;">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">ตั้งค่าระบบรับสมัคร</h5>
            </div>
            <div class="card-body" id="settingsContent">
            </div>
          </div>
        </div>

        <div class="tab-content" id="backupTab" style="display: none;">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">สำรองข้อมูล</h5>
            </div>
            <div class="card-body">
              <div class="alert alert-warning">
                <i class="bi bi-exclamation-triangle"></i> 
                กรุณาสำรองข้อมูลอย่างสม่ำเสมอเพื่อป้องกันข้อมูลสูญหาย
              </div>
              <button class="btn btn-success mb-4" id="btnBackupNow">
                <i class="bi bi-download"></i> สำรองข้อมูลทันที
              </button>
              
              <hr>
              
              <div class="alert alert-danger">
                <i class="bi bi-exclamation-circle"></i> 
                <strong>เปลี่ยนปีการศึกษา:</strong> จะล้างข้อมูลผู้สมัครทั้งหมด (ระบบจะสำรองข้อมูลให้อัตโนมัติ)
              </div>
              <button class="btn btn-danger" id="btnChangeYear">
                <i class="bi bi-calendar"></i> เปลี่ยนปีการศึกษา
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="container mt-4" id="applicationForm" style="display: none;">
    <div class="card shadow-sm">
      <div class="card-header bg-warning text-dark">
        <h5 class="mb-0"><i class="bi bi-pencil-square"></i> แบบฟอร์มสมัครเรียน</h5>
        <small id="formTypeLabel"></small>
      </div>
      <div class="card-body">
        <form id="registrationForm">
          <input type="hidden" id="formApplicationType" name="applicationType">
          <input type="hidden" id="formSubType" name="subType">

          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label required">เลขบัตรประชาชน / เลขบัตรคนต่างด้าว</label>
              <input type="text" class="form-control" id="formNationalId" name="nationalId" maxlength="13" required readonly>
            </div>

            <div class="col-md-6">
              <label class="form-label required">คำนำหน้า</label>
              <select class="form-select" id="formPrefix" name="prefix" required>
                <option value="">เลือก</option>
                <option value="เด็กชาย">เด็กชาย</option>
                <option value="เด็กหญิง">เด็กหญิง</option>
                <option value="นาย">นาย</option>
                <option value="นางสาว">นางสาว</option>
              </select>
            </div>

            <div class="col-md-12">
              <label class="form-label required">ชื่อ-นามสกุล (ไม่ต้องกรอกคำนำหน้าชื่อ)</label>
              <input type="text" class="form-control" id="formFullName" name="fullName" placeholder="ชื่อ นามสกุล" required>
            </div>

            <div class="col-md-6">
              <label class="form-label required">เบอร์โทรศัพท์นักเรียน</label>
              <input type="tel" class="form-control" id="formStudentPhone" name="studentPhone" required>
            </div>

            <div class="col-md-6">
              <label class="form-label required">ชื่อผู้ปกครอง (ตัวอย่าง นางสาวบางมด ใจดี)</label>
              <input type="text" class="form-control" id="formParentName" name="parentName" required>
            </div>

            <div class="col-md-6">
              <label class="form-label required">เบอร์โทรศัพท์ผู้ปกครอง</label>
              <input type="tel" class="form-control" id="formParentPhone" name="parentPhone" required>
            </div>

            <div class="col-md-6">
              <label class="form-label required">ความสัมพันธ์</label>
              <select class="form-select" id="formRelationship" name="relationship" required>
                <option value="">เลือก</option>
                <option value="บิดา">บิดา</option>
                <option value="มารดา">มารดา</option>
                <option value="ผู้ปกครอง">ผู้ปกครอง</option>
              </select>
            </div>

            <div class="col-md-6" id="districtTypeGroup" style="display: none;">
              <label class="form-label required">ประเภทเขต</label>
              <select class="form-select" id="formDistrictType" name="districtType">
                <option value="">เลือก</option>
                <option value="ในเขต">ในเขต</option>
                <option value="นอกเขต">นอกเขต</option>
              </select>
            </div>

            <div class="col-md-6" id="specialSkillGroup" style="display: none;">
              <label class="form-label required">ความสามารถพิเศษ</label>
              <select class="form-select" id="formSpecialSkill" name="specialSkill">
                <option value="">เลือก</option>
                <option value="นาฏศิลป์">นาฏศิลป์</option>
                <option value="ดนตรีไทย">ดนตรีไทย</option>
                <option value="ฟุตซอลชาย">ฟุตซอลชาย</option>
                <option value="ฟุตซอลหญิง">ฟุตซอลหญิง</option>
                <option value="บาสเกตบอลชาย">บาสเกตบอลชาย</option>
                <option value="บาสเกตบอลหญิง">บาสเกตบอลหญิง</option>
              </select>
            </div>

<div class="col-md-12" id="previousSchoolGroup" style="display: none;">
  <label class="form-label required">โรงเรียนเดิม</label>
  <input type="text" class="form-control" id="formPreviousSchool" name="previousSchool">
</div>

            <div class="col-md-6">
              <label class="form-label required">ไฟล์ทะเบียนบ้าน (PDF/JPG/PNG)</label>
              <input type="file" class="form-control" id="fileHouseReg" name="houseRegFile" accept=".pdf,.jpg,.jpeg,.png" required>
              <small class="text-muted">ขนาดไฟล์ไม่เกิน 5MB</small>
            </div>

            <div class="col-md-6">
              <label class="form-label required">ไฟล์ใบรับรอง (PDF/JPG/PNG)</label>
              <input type="file" class="form-control" id="fileTranscript" name="transcriptFile" accept=".pdf,.jpg,.jpeg,.png" required>
              <small class="text-muted">ขนาดไฟล์ไม่เกิน 5MB</small>
            </div>

            <div class="col-12 mt-4">
              <button type="button" class="btn btn-secondary me-2" id="btnCancelForm">
                <i class="bi bi-x-circle"></i> ยกเลิก
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-check-circle"></i> ยืนยันการสมัคร
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <div class="modal fade" id="printModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header no-print">
          <h5 class="modal-title">พิมพ์บัตรผู้สมัคร</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="printCardContent">
        </div>
        <div class="modal-footer no-print">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ปิด</button>
          <button type="button" class="btn btn-primary" onclick="window.print()">
            <i class="bi bi-printer"></i> พิมพ์
          </button>
        </div>
      </div>
    </div>
  </div>

  <div id="loadingOverlay" style="display: none;">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">กำลังโหลด...</span>
    </div>
    <p class="mt-2">กำลังดำเนินการ...</p>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.3.0/dist/chart.umd.min.js"></script>
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  
  <?!= include('javascript'); ?>
</body>
</html>